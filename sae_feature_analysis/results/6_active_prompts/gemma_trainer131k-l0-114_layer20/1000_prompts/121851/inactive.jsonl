{"prompt_id": 477, "prompt_text": "python3 code:\nclass ConnectionManager:\nSTATE_FILE = \"/NAME_1/data/state.pkl\"\n\ndef __init__(self):\n    self.active_connections: Dict[int, WebSocket] = {}\n    self.state = {\n        \"global\": {},\n        \"local\": {}\n    }\n\n    # expose NAME_1.state.global_state and NAME_1.state.local_state as properties\n    # self.state = NAME_1.state.internal_shared_sate\n\n\n    self.load_state()\n\ndef save_state(self):\n    with open(self.STATE_FILE, \"wb\") as f:\n        pickle.dump(self.state, f)\n\ndef load_state(self):\n    if os.path.exists(self.STATE_FILE):\n        try:\n            with open(self.STATE_FILE, \"rb\") as f:\n                self.state = pickle.load(f)\n        except Exception as e:\n            print(f\"Error loading state: {e}\")\n\nasync def connect(self, websocket: WebSocket, client_id: str):\n    await websocket.accept()\n    self.active_connections[client_id] = websocket\n\ndef disconnect(self, client_id: int):\n    if client_id in self.active_connections:\n        try:\n            # In case a client disconnects without having logged in.\n            del websocket_client_id_username[client_id]\n        except KeyError:\n            pass\n        del self.active_connections[client_id]\n\nasync def apply_global_mutations(self , mutations: dict, sync=True):\n    for key, value in mutations.items():\n        self.state[\"global\"][key] = value\n    if sync:\n        await self.sync_global_state()\n\nasync def apply_local_mutations(self, client_id: str, mutations: dict, sync=True):\n    username = websocket_client_id_username[client_id]\n    if username not in self.state[\"local\"]:\n        self.state[\"local\"][username] = {}\n    for key, value in mutations.items():\n        self.state[\"local\"][username][key] = value\n    if sync:\n        await self.sync_local_state(client_id)\n\nasync def send_personal_message(self, client_id: str, message: str):\n    if client_id in self.active_connections:\n        websocket = self.active_connections[client_id]\n        try:\n            await websocket.send_text(message)\n        except Exception as e:\n            print(f\"Error sending message to {client_id}: {e}\")\n            self.disconnect(client_id)\n\nasync def broadcast(self, message: str):\n    for client_id in list(self.active_connections.keys()):\n        await self.send_personal_message(message, client_id)\n\n    # Sync all states for all\n\nasync def global_sync(self):\n    await self.sync_global_state()\n    await self.sync_local_states_for_all()\n\nasync def sync_global_state(self):\n    state_message = {\n        \"type\": \"sync\",\n        \"scope\": \"global\",\n        \"state\": self.state[\"g", "tokenized_prompt": ["<bos>", "<bos>", "<start_of_turn>", "user", "\n", "python", "3", " code", ":", "\n", "class", " Connection", "Manager", ":", "\n", "STATE", "_", "FILE", " =", " \"/", "NAME", "_", "1", "/", "data", "/", "state", ".", "pkl", "\"", "\n\n", "def", " __", "init", "__(", "self", "):", "\n", "    ", "self", ".", "active", "_", "connections", ":", " Dict", "[", "int", ",", " WebSocket", "]", " =", " {}", "\n", "    ", "self", ".", "state", " =", " {", "\n", "        ", "\"", "global", "\":", " {},", "\n", "        ", "\"", "local", "\":", " {}", "\n", "    ", "}", "\n\n", "    ", "#", " expose", " NAME", "_", "1", ".", "state", ".", "global", "_", "state", " and", " NAME", "_", "1", ".", "state", ".", "local", "_", "state", " as", " properties", "\n", "    ", "#", " self", ".", "state", " =", " NAME", "_", "1", ".", "state", ".", "internal", "_", "shared", "_", "sate", "\n\n\n", "    ", "self", ".", "load", "_", "state", "()", "\n\n", "def", " save", "_", "state", "(", "self", "):", "\n", "    ", "with", " open", "(", "self", ".", "STATE", "_", "FILE", ",", " \"", "wb", "\")", " as", " f", ":", "\n", "        ", "pickle", ".", "dump", "(", "self", ".", "state", ",", " f", ")", "\n\n", "def", " load", "_", "state", "(", "self", "):", "\n", "    ", "if", " os", ".", "path", ".", "exists", "(", "self", ".", "STATE", "_", "FILE", "):", "\n", "        ", "try", ":", "\n", "            ", "with", " open", "(", "self", ".", "STATE", "_", "FILE", ",", " \"", "rb", "\")", " as", " f", ":", "\n", "                ", "self", ".", "state", " =", " pickle", ".", "load", "(", "f", ")", "\n", "        ", "except", " Exception", " as", " e", ":", "\n", "            ", "print", "(", "f", "\"", "Error", " loading", " state", ":", " {", "e", "}\")", "\n\n", "async", " def", " connect", "(", "self", ",", " websocket", ":", " WebSocket", ",", " client", "_", "id", ":", " str", "):", "\n", "    ", "await", " websocket", ".", "accept", "()", "\n", "    ", "self", ".", "active", "_", "connections", "[", "client", "_", "id", "]", " =", " websocket", "\n\n", "def", " disconnect", "(", "self", ",", " client", "_", "id", ":", " int", "):", "\n", "    ", "if", " client", "_", "id", " in", " self", ".", "active", "_", "connections", ":", "\n", "        ", "try", ":", "\n", "            ", "#", " In", " case", " a", " client", " dis", "connects", " without", " having", " logged", " in", ".", "\n", "            ", "del", " websocket", "_", "client", "_", "id", "_", "username", "[", "client", "_", "id", "]", "\n", "        ", "except", " KeyError", ":", "\n", "            ", "pass", "\n", "        ", "del", " self", ".", "active", "_", "connections", "[", "client", "_", "id", "]", "\n\n", "async", " def", " apply", "_", "global", "_", "mutations", "(", "self", " ,", " mutations", ":", " dict", ",", " sync", "=", "True", "):", "\n", "    ", "for", " key", ",", " value", " in", " mutations", ".", "items", "():", "\n", "        ", "self", ".", "state", "[\"", "global", "\"][", "key", "]", " =", " value", "\n", "    ", "if", " sync", ":", "\n", "        ", "await", " self", ".", "sync", "_", "global", "_", "state", "()", "\n\n", "async", " def", " apply", "_", "local", "_", "mutations", "(", "self", ",", " client", "_", "id", ":", " str", ",", " mutations", ":", " dict", ",", " sync", "=", "True", "):", "\n", "    ", "username", " =", " websocket", "_", "client", "_", "id", "_", "username", "[", "client", "_", "id", "]", "\n", "    ", "if", " username", " not", " in", " self", ".", "state", "[\"", "local", "\"]:", "\n", "        ", "self", ".", "state", "[\"", "local", "\"][", "username", "]", " =", " {}", "\n", "    ", "for", " key", ",", " value", " in", " mutations", ".", "items", "():", "\n", "        ", "self", ".", "state", "[\"", "local", "\"][", "username", "][", "key", "]", " =", " value", "\n", "    ", "if", " sync", ":", "\n", "        ", "await"], "max_feature_activation": 0.0}
{"prompt_id": 763, "prompt_text": "\u0414\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e- \u0430\u043d\u0430\u043b\u0456\u0442\u0438\u0447\u043d\u043e\u0457 \u043b\u0430\u0431\u043e\u0440\u0430\u0442\u043e\u0440\u0456\u0457 \u043d\u0430 \u0430\u043d\u0430\u043b\u0456\u0437 \u043d\u0430\u0434\u0456\u0439\u0448\u043b\u0438 \u0422\u0430\u0431\u043b\u0435\u0442\u043a\u0438 \u0444\u0435\u043d\u0456\u043b\u0431\u0443\u0442\u0430\u0437\u043e\u043d\u0443 ( \u0431\u0443\u0442\u0430\u0434\u0456\u043e\u043d\u0443 ) 0,15 \u0433. \u0420\u043e\u0437\u0440\u0430\u0445\u0443\u0439\u0442\u0435 \u043d\u0430\u0432\u0430\u0436\u043a\u0443 \u043f\u043e\u0440\u043e\u0448\u043a\u0443 \u0440\u043e\u0437\u0442\u0435\u0440\u0442\u0438\u0445 \u0442\u0430\u0431\u043b\u0435\u0442\u043e\u043a, \u044f\u043a\u0443 \u0441\u043b\u0456\u0434 \u0432\u0437\u044f\u0442\u0438, \u0449\u043e\u0431 \u043d\u0430 \u0457\u0445 \u0442\u0438\u0442\u0440\u0443\u0432\u0430\u043d\u043d\u044f \u0431\u0443\u043b\u043e \u0432\u0438\u0442\u0440\u0430\u0447\u0435\u043d\u043e 9,00 \u043c\u043b \u0442\u0438\u0442\u0440\u043e\u0432\u0430\u043d\u043e\u0433\u043e \u0440\u043e\u0437\u0447\u0438\u043d\u0443 \u043d\u0430\u0442\u0440\u0456\u044e \u0433\u0456\u0434\u0440\u043e\u043a\u0441\u0438\u0434\u0443 (0,1 \u043c\u043e\u043b\u044c/\u043b) \u0437 \u041a 0,9978. \u0421\u0435\u0440\u0435\u0434\u043d\u044f \u043c\u0430\u0441\u0430 \u0442\u0430\u0431\u043b\u0435\u0442\u043e\u043a 0,260 \u0433. \u041c.\u043c. \u0444\u0435\u043d\u0456\u043b\u0431\u0443\u0442\u0430\u0437\u043e\u043d\u0443(\u0431\u0443\u0442\u0430\u0434\u0456\u043e\u043d\u0443) 308,38", "tokenized_prompt": ["<bos>", "<bos>", "<start_of_turn>", "user", "\n", "\u0414\u043e", " \u043a\u043e\u043d\u0442\u0440\u043e", "\u043b\u044c\u043d\u043e", "-", " \u0430\u043d\u0430", "\u043b\u0456", "\u0442\u0438", "\u0447\u043d\u043e\u0457", " \u043b\u0430\u0431\u043e\u0440\u0430", "\u0442\u043e", "\u0440\u0456\u0457", " \u043d\u0430", " \u0430\u043d\u0430", "\u043b\u0456\u0437", " \u043d\u0430", "\u0434\u0456\u0439", "\u0448\u043b\u0438", " \u0422\u0430", "\u0431\u043b\u0435", "\u0442\u043a\u0438", " \u0444", "\u0435\u043d\u0456", "\u043b", "\u0431\u0443", "\u0442\u0430", "\u0437\u043e", "\u043d\u0443", " (", " \u0431\u0443", "\u0442\u0430", "\u0434\u0456", "\u043e\u043d\u0443", " )", " ", "0", ",", "1", "5", " \u0433", ".", " \u0420\u043e", "\u0437\u0440\u0430", "\u0445\u0443", "\u0439\u0442\u0435", " \u043d\u0430", "\u0432\u0430", "\u0436\u043a\u0443", " \u043f\u043e\u0440\u043e", "\u0448\u043a\u0443", " \u0440\u043e\u0437", "\u0442\u0435\u0440", "\u0442\u0438\u0445", " \u0442\u0430\u0431\u043b\u0435", "\u0442\u043e\u043a", ",", " \u044f\u043a\u0443", " \u0441\u043b\u0456\u0434", " \u0432\u0437\u044f", "\u0442\u0438", ",", " \u0449\u043e\u0431", " \u043d\u0430", " \u0457\u0445", " \u0442\u0438", "\u0442\u0440\u0443", "\u0432\u0430\u043d\u043d\u044f", " \u0431\u0443\u043b\u043e", " \u0432\u0438\u0442\u0440\u0430", "\u0447\u0435\u043d\u043e", " ", "9", ",", "0", "0", " \u043c\u043b", " \u0442\u0438", "\u0442", "\u0440\u043e\u0432\u0430", "\u043d\u043e\u0433\u043e", " \u0440\u043e\u0437", "\u0447\u0438", "\u043d\u0443", " \u043d\u0430\u0442", "\u0440\u0456", "\u044e", " \u0433", "\u0456\u0434", "\u0440\u043e\u043a", "\u0441\u0438", "\u0434\u0443", " (", "0", ",", "1", " \u043c\u043e", "\u043b\u044c", "/", "\u043b", ")", " \u0437", " \u041a", " ", "0", ",", "9", "9", "7", "8", ".", " \u0421\u0435\u0440\u0435", "\u0434\u043d\u044f", " \u043c\u0430\u0441\u0430", " \u0442\u0430\u0431\u043b\u0435", "\u0442\u043e\u043a", " ", "0", ",", "2", "6", "0", " \u0433", ".", " \u041c", ".", "\u043c", ".", " \u0444", "\u0435\u043d\u0456", "\u043b", "\u0431\u0443", "\u0442\u0430", "\u0437\u043e", "\u043d\u0443", "(", "\u0431\u0443", "\u0442\u0430", "\u0434\u0456", "\u043e\u043d\u0443", ")", " ", "3", "0", "8", ",", "3", "8", "<end_of_turn>", "\n", "<start_of_turn>", "model", "\n"], "max_feature_activation": 0.0}
