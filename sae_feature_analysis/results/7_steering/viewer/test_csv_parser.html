<!DOCTYPE html>
<html>
<head>
    <title>CSV Parser Test</title>
</head>
<body>
    <h1>CSV Parser Test</h1>
    <div id="test-results"></div>
    
    <script>
        // Copy the fixed parseCSVLine function
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
                        // Escaped quote - add literal quote and skip next character
                        current += '"';
                        i++; // Skip the next quote
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }
        
        // Test cases
        const testCases = [
            {
                input: '93,https://www.neuronpedia.org/gemma-2-9b/20-gemmascope-res-131k/93,"Column headers and data labels in scientific tables, often containing variable names, units of measurement (like ""(mg m^-2)"", ""(%)""), and special notation like ""value"" or ""Ref."" The marked tokens typically appear at the top or left sections of data tables in academic papers, identifying what type of data is presented in each column or row."',
                expected: [
                    '93',
                    'https://www.neuronpedia.org/gemma-2-9b/20-gemmascope-res-131k/93',
                    'Column headers and data labels in scientific tables, often containing variable names, units of measurement (like "(mg m^-2)", "(%)""), and special notation like "value" or "Ref." The marked tokens typically appear at the top or left sections of data tables in academic papers, identifying what type of data is presented in each column or row.'
                ]
            },
            {
                input: '118,https://www.neuronpedia.org/gemma-2-9b/20-gemmascope-res-131k/118,"Phrases describing how people spend their time, often in lists of activities connected by coordinating conjunctions (""and"", ""or"") and sometimes qualified by adverbs like ""just""."',
                expected: [
                    '118',
                    'https://www.neuronpedia.org/gemma-2-9b/20-gemmascope-res-131k/118',
                    'Phrases describing how people spend their time, often in lists of activities connected by coordinating conjunctions ("and", "or") and sometimes qualified by adverbs like "just".'
                ]
            }
        ];
        
        let results = '<h2>Test Results:</h2>';
        let allPassed = true;
        
        testCases.forEach((testCase, index) => {
            const result = parseCSVLine(testCase.input);
            const passed = JSON.stringify(result) === JSON.stringify(testCase.expected);
            allPassed = allPassed && passed;
            
            results += `<h3>Test ${index + 1}: ${passed ? '✅ PASS' : '❌ FAIL'}</h3>`;
            results += `<p><strong>Input:</strong> <code>${testCase.input}</code></p>`;
            results += `<p><strong>Expected:</strong> <pre>${JSON.stringify(testCase.expected, null, 2)}</pre></p>`;
            results += `<p><strong>Got:</strong> <pre>${JSON.stringify(result, null, 2)}</pre></p>`;
            results += '<hr>';
        });
        
        results += `<h2>Overall: ${allPassed ? '✅ ALL TESTS PASSED' : '❌ SOME TESTS FAILED'}</h2>`;
        
        document.getElementById('test-results').innerHTML = results;
    </script>
</body>
</html>